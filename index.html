<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enerzo â€“ TÃ¬m tráº¡m sáº¡c nhanh chÃ³ng</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
<style>
:root { --brand:#15803d; --accent:#10b981; }

/* CSS mapStyleSwitcher */
#mapStyleSwitcher {
  display: flex;
  gap: 6px;
  margin: 8px 0;
}
#mapStyleSwitcher button {
  padding: 6px 10px;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
  background: #fff;
  cursor: pointer;
  font-size: 13px;
  font-weight: 600;
}
#mapStyleSwitcher button.active {
  background: var(--brand);
  color: #fff;
}

/* CÃ¡c CSS cÅ© cá»§a báº¡n */
body { font-family:Inter, sans-serif; margin:0; background:#f3f4f6; color:#0f172a; }
header { background:linear-gradient(90deg,var(--brand),#166534); color:#fff; padding:14px 16px; display:flex; align-items:center; gap:12px; box-shadow:0 2px 6px rgba(2,6,23,0.08); }
header .title { font-size:18px; font-weight:700; }
main { padding:14px; padding-bottom:84px; }
#map { height:360px; border-radius:12px; box-shadow:0 6px 18px rgba(2,6,23,0.08); overflow:hidden; }
.controls { display:flex; gap:8px; align-items:center; margin-top:10px; }
.btn { background:var(--brand); color:#fff; padding:8px 12px; border-radius:10px; border:none; cursor:pointer; font-weight:600; }
.btn.ghost { background:#fff; color:var(--brand); border:1px solid #e2e8f0; }
.panel { background:#fff; padding:12px; border-radius:12px; box-shadow:0 6px 18px rgba(2,6,23,0.04); margin-top:12px; }
.station-item { display:flex; justify-content:space-between; align-items:center; padding:10px; border-radius:10px; border:1px solid #e6eef6; margin-bottom:8px; }
.station-meta { font-size:13px; color:#334155; }
footer.nav { position:fixed; left:0; right:0; bottom:0; background:#fff; border-top:1px solid #e6eef6; display:flex; justify-content:space-around; padding:10px 0; box-shadow:0 -4px 18px rgba(2,6,23,0.04); }
footer.nav button { background:none; border:none; color:var(--brand); font-weight:700; cursor:pointer; }
footer.nav button.active { color:#0f172a; }
.section { display:none; }
.section.active { display:block; }
.small { font-size:13px; color:#475569; }
.badge { background:var(--accent); color:#fff; padding:6px 8px; border-radius:8px; font-weight:700; }
.empty { color:#64748b; text-align:center; padding:18px; }
.booking-item { border:1px solid #eef2ff; padding:10px; border-radius:10px; margin-bottom:8px; background:#fff; }
.booking-meta { font-size:13px; color:#475569; }

/* Modal */
.modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
.modal-content { background:#fff; padding:20px; border-radius:12px; width:300px; box-shadow:0 6px 18px rgba(2,6,23,0.2); display:flex; flex-direction:column; gap:12px; }
.modal-content input, .modal-content select { padding:8px 12px; border-radius:8px; border:1px solid #ccc; width:100%; }
.modal-content button { padding:10px 12px; border-radius:8px; border:none; background:var(--brand); color:#fff; font-weight:600; cursor:pointer; }
.modal-content .close-btn { background:#f87171; }
</style>
</head>
<body>
<header>
<div class="title">Enerzo â€“ TÃ¬m tráº¡m sáº¡c nhanh chÃ³ng</div>
<div style="margin-left:auto; display:flex; gap:8px; align-items:center;">
<div class="small" style="color:rgba(255,255,255,0.9)">â­ <span id="points-badge">0</span> Ä‘iá»ƒm</div>
<button id="login-btn" class="btn ghost">ÄÄƒng nháº­p</button>
<button id="logout-btn" class="btn ghost" style="display:none;">ÄÄƒng xuáº¥t</button>
</div>
</header>
<main>
<section id="home" class="section active">
  <div id="map"></div>

  <!-- Bá»™ chá»n kiá»ƒu báº£n Ä‘á»“ -->
  <div id="mapStyleSwitcher">
    <button id="streetBtn" class="active">ÄÆ°á»ng phá»‘</button>
    <button id="satelliteBtn">Vá»‡ tinh</button>
    <button id="terrainBtn">Äá»‹a hÃ¬nh</button>
  </div>

  <div class="controls">
    <button class="btn" id="locate-btn">ğŸ“ QuÃ©t vá»‹ trÃ­</button>
    <button class="btn ghost" id="refresh-markers">â†» Cáº­p nháº­t tráº¡m</button>
  </div>
  <div class="panel">
    <h3 style="margin:0 0 8px 0">Tráº¡m sáº¡c gáº§n báº¡n</h3>
    <div id="stations-list"></div>
  </div>
</section>
<div class="controls">
<button class="btn" id="locate-btn">ğŸ“ QuÃ©t vá»‹ trÃ­</button>
<button class="btn ghost" id="refresh-markers">â†» Cáº­p nháº­t tráº¡m</button>
</div>
<div class="panel">
<h3 style="margin:0 0 8px 0">Tráº¡m sáº¡c gáº§n báº¡n</h3>
<div id="stations-list"></div>
</div>
</section>
<section id="bookings" class="section">
<div class="panel">
<h3>ğŸ“… Äáº·t chá»— cá»§a tÃ´i</h3>
<div id="bookings-list"></div>
</div>
</section>
<section id="promo" class="section">
<div class="panel">
<h3>ğŸ Khuyáº¿n mÃ£i</h3>
<p>Nháº­p mÃ£ <b>ENERZO20</b> Ä‘á»ƒ giáº£m 20% khi Ä‘áº·t chá»—.</p>
<P>Nháº­p mÃ£ <b>CDLOGT28GH</b> Ä‘á»ƒ giáº£m 50% khi Ä‘áº·t chá»—.</P>
<p>Nháº­p mÃ£ <b>7SHARKS</b> Ä‘á»ƒ giáº£m 70% khi Ä‘áº·t chá»—.</p>
</div>
</section>
<section id="points" class="section">
<div class="panel">
<h3>â­ TÃ­ch Ä‘iá»ƒm</h3>
<p class="small">Äiá»ƒm hiá»‡n cÃ³ Ä‘Æ°á»£c lÆ°u trÃªn thiáº¿t bá»‹ (localStorage). Báº¡n nháº­n Ä‘iá»ƒm khi Ä‘áº·t chá»—.</p>
<div style="margin-top:8px"><span class="badge" id="points-big">0</span></div>
</div>
</section>
<section id="profile" class="section">
<div class="panel">
<h3>ğŸ‘¤ CÃ¡ nhÃ¢n</h3>
<p class="small">TÃªn: <b id="user-name">KhÃ¡ch vÃ£ng lai</b></p>
<p class="small">Email: <span id="user-email">ChÆ°a Ä‘Äƒng nháº­p</span></p>
</div>
</section>
</main>
<footer class="nav">
<button data-target="home" class="active">ğŸ  Trang chá»§</button>
<button data-target="bookings">ğŸ“… Äáº·t chá»—</button>
<button data-target="promo">ğŸ Khuyáº¿n mÃ£i</button>
<button data-target="points">â­ TÃ­ch Ä‘iá»ƒm</button>
<button data-target="profile">ğŸ‘¤ CÃ¡ nhÃ¢n</button>
</footer>

<!-- Modal Login -->
<div id="login-modal" class="modal">
  <div class="modal-content">
    <h3>ÄÄƒng nháº­p Enerzo</h3>
    <input type="text" id="login-name" placeholder="TÃªn cá»§a báº¡n">
    <input type="email" id="login-email" placeholder="Email">
    <button id="submit-login">ÄÄƒng nháº­p</button>
    <button id="close-login" class="close-btn">ÄÃ³ng</button>
  </div>
</div>

<!-- Modal Thanh ToÃ¡n -->
<div id="payment-modal" class="modal">
  <div class="modal-content">
    <h3>Thanh toÃ¡n Ä‘áº·t chá»—</h3>

    <input type="text" id="promo-code" placeholder="Nháº­p mÃ£ khuyáº¿n mÃ£i (náº¿u cÃ³)">
    <select id="payment-method">
      <option value="VNPay">VNPay</option>
      <option value="MoMo">MoMo</option>
      <option value="Tháº»">Tháº»</option>
    </select>

    <button id="confirm-payment">XÃ¡c nháº­n</button>
    <button id="close-payment" class="close-btn">Há»§y</button>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://unpkg.com/leaflet-semicircle"></script>
<script>
let stations=[
{id:1,name:'VinFast - Thá»§ Äá»©c',lat:10.8546,lon:106.7840,slots:4,price:15},
{id:2,name:'EVN Station - Q9',lat:10.8375,lon:106.7768,slots:2,price:12},
{id:3,name:'Äiá»‡n Quang - BÃ¬nh Tháº¡nh',lat:10.8038,lon:106.7183,slots:6,price:10},
{id:4,name:'ChargeHub - Linh Trung',lat:10.8721,lon:106.7832,slots:3,price:18},
{id:5,name:'VinFast BÃ£i Ä‘á»— xe 882',lat:10.8218,lon:106.7895,slots:5,price:15},
{id:6,name:'VinFast BÃ£i Ä‘á»— xe PhÃº Há»¯u',lat:10.8225,lon:106.7970,slots:4,price:15},
{id:7,name:'VinFast Chung cÆ° Sky 9 CT1',lat:10.8210,lon:106.8015,slots:6,price:15},
{id:8,name:'VinFast PVOIL PhÃº Há»¯u',lat:10.8190,lon:106.8050,slots:3,price:12},
{id:9,name:'VinFast 9/1 VÃµ VÄƒn HÃ¡t',lat:10.8285,lon:106.8130,slots:4,price:15},
{id:10,name:'VinFast BÃ£i Ä‘á»— xe Long TrÆ°á»ng',lat:10.8305,lon:106.8200,slots:5,price:15},
{id:11,name:'VinFast TÆ° nhÃ¢n Long TrÆ°á»ng',lat:10.8320,lon:106.8245,slots:3,price:12},
{id:12,name:'Tráº¡m sáº¡c 120 Ä‘Æ°á»ng 11 - TrÆ°á»ng Thá»',lat:10.8485,lon:106.7510,slots:2,price:10},
{id:13,name:'VinFast Vinhomes Grand Park',lat:10.8425,lon:106.8280,slots:8,price:18},
{id:14,name:'VinFast Chung cÆ° The Eastern',lat:10.8255,lon:106.8075,slots:5,price:15},
{id:15,name:'Tráº¡m sáº¡c Ava - TrÆ°á»ng Thá»',lat:10.8490,lon:106.7530,slots:3,price:12}
];

let bookings=JSON.parse(localStorage.getItem('ez_bookings')||'[]');
let points=parseInt(localStorage.getItem('ez_points')||'0',10);
let currentUser=JSON.parse(localStorage.getItem('ez_user')||'null');
let pendingStation=null;
let userLocation=null;

const loginBtn=document.getElementById('login-btn');
const logoutBtn=document.getElementById('logout-btn');

function updateUI(){
  document.getElementById('points-badge').textContent=points;
  document.getElementById('points-big').textContent=points;
  if(currentUser){
    document.getElementById('user-name').textContent=currentUser.name;
    document.getElementById('user-email').textContent=currentUser.email;
    loginBtn.style.display='none'; logoutBtn.style.display='inline-block';
  } else {
    document.getElementById('user-name').textContent='KhÃ¡ch vÃ£ng lai';
    document.getElementById('user-email').textContent='ChÆ°a Ä‘Äƒng nháº­p';
    loginBtn.style.display='inline-block'; logoutBtn.style.display='none';
  }
}
updateUI();

// ===== Modal login =====
loginBtn.addEventListener('click',()=>{ document.getElementById('login-modal').style.display='flex'; });
document.getElementById('close-login').addEventListener('click',()=>{ document.getElementById('login-modal').style.display='none'; });
document.getElementById('submit-login').addEventListener('click',()=>{
  const name=document.getElementById('login-name').value.trim();
  const email=document.getElementById('login-email').value.trim();
  if(name && email){
    currentUser={name,email};
    localStorage.setItem('ez_user',JSON.stringify(currentUser));
    updateUI();
    document.getElementById('login-modal').style.display='none';
    alert('ÄÄƒng nháº­p thÃ nh cÃ´ng!');
  } else alert('Vui lÃ²ng nháº­p Ä‘á»§ tÃªn vÃ  email!');
});
logoutBtn.addEventListener('click',()=>{
  currentUser=null;
  localStorage.removeItem('ez_user');
  updateUI();
  alert('ÄÃ£ Ä‘Äƒng xuáº¥t!');
});

// ===== Map init =====
const map=L.map('map').setView([10.8546,106.7840],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'Â© OpenStreetMap'}).addTo(map);
// ===== Váº½ vá»‹ trÃ­ ngÆ°á»i dÃ¹ng (cháº¥m xanh + bÃ³ng hÆ°á»›ng) =====
let userMarker = null;
let userCone = null;

function updateUserMarker(lat, lon, heading = 0) {
  if (userMarker) map.removeLayer(userMarker);
  if (userCone) map.removeLayer(userCone);

  // cháº¥m xanh
  userMarker = L.circleMarker([lat, lon], {
    radius: 10,
    color: "#2563eb",
    fillColor: "#2563eb",
    fillOpacity: 1,
    weight: 2
  }).addTo(map);

  // bÃ³ng hÆ°á»›ng Ä‘i (90Â° lÃ  gÃ³c má»Ÿ)
  if (L.semiCircle) {
    userCone = L.semiCircle([lat, lon], {
      radius: 80,
      color: "#3b82f6",
      fillColor: "#3b82f6",
      fillOpacity: 0.2
    }).setDirection(heading, 90).addTo(map);
  }
}
// ===== Helpers =====
function distance(lat1, lon1, lat2, lon2){
  function toRad(v){return v*Math.PI/180;}
  const R=6371; // km
  const dLat=toRad(lat2-lat1), dLon=toRad(lon2-lon1);
  const a=Math.sin(dLat/2)**2+Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
  return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}

// ===== Booking =====
window.bookFromMap = function(id){
  if(!currentUser){alert('Vui lÃ²ng Ä‘Äƒng nháº­p!'); return;}
  const st=stations.find(s=>s.id===id);
  if(st.slots<=0){alert('Háº¿t chá»— trá»‘ng!'); return;}
  pendingStation=st;
  document.getElementById('payment-modal').style.display='flex';
}
document.getElementById('close-payment').addEventListener('click',()=>{
  document.getElementById('payment-modal').style.display='none';
  pendingStation=null;
});
document.getElementById('confirm-payment').addEventListener('click', () => {
  if (!pendingStation) return;
  let st = pendingStation;
  if (st.slots <= 0) { alert('Háº¿t chá»— trá»‘ng!'); return; }
  st.slots--;

  // --- TÃ­nh giÃ¡ vÃ  mÃ£ khuyáº¿n mÃ£i (giá»¯ logic cÅ©) ---
  let price = st.price;
  const code = document.getElementById('promo-code').value.trim();
  if (code === "ENERZO20") price = price * 0.8;
  else if (code === "CDLOGT28GH") price = price * 0.5;
  else if (code === "7SHARKS") price = price * 0.3;

  const method = document.getElementById('payment-method').value;
  const expireTime = Date.now() + 30 * 60 * 1000; // 30 phÃºt

  // --- LÆ°u Ä‘áº·t chá»— ---
  bookings.push({
    id: Date.now(),
    station: st.name,
    price: price,
    method: method,
    status: "ÄÃ£ thanh toÃ¡n",
    date: new Date().toLocaleString(),
    expire: expireTime
  });

  // --- Cáº­p nháº­t Ä‘iá»ƒm vÃ  lÆ°u localStorage ---
  points += 5;
  localStorage.setItem('ez_bookings', JSON.stringify(bookings));
  localStorage.setItem('ez_points', points);

  // --- Cáº­p nháº­t UI ---
  updateUI();
  renderBookings();
  renderStations();

  // áº©n modal thanh toÃ¡n
  document.getElementById('payment-modal').style.display = 'none';
  pendingStation = null;

  // --- Chá»‰ Ä‘Æ°á»ng: xÃ³a route cÅ© rá»“i váº½ route má»›i (náº¿u Ä‘Ã£ cÃ³ vá»‹ trÃ­ ngÆ°á»i dÃ¹ng) ---
  if (userLocation) {
    // váº½ cháº¥m xanh + bÃ³ng hÆ°á»›ng (náº¿u báº¡n Ä‘Ã£ Ä‘á»‹nh nghÄ©a updateUserMarker)
    if (typeof updateUserMarker === 'function') {
      updateUserMarker(userLocation.lat, userLocation.lon, 0);
    }

    // xÃ³a route cÅ© náº¿u cÃ³
    if (window.currentRoute) {
      try { map.removeControl(window.currentRoute); } catch(e) {}
      window.currentRoute = null;
    }

    // táº¡o route má»›i
    window.currentRoute = L.Routing.control({
      waypoints: [
        L.latLng(userLocation.lat, userLocation.lon),
        L.latLng(st.lat, st.lon)
      ],
      lineOptions: { styles: [{ color: "#2563eb", weight: 6 }] },
      routeWhileDragging: false,
      addWaypoints: false,
      draggableWaypoints: false,
      show: false
    }).addTo(map);
  }

  Swal.fire({
  icon: 'success',
  title: 'Äáº¶T CHá»– THÃ€NH CÃ”NG',
  text: `Báº¡n Ä‘Ã£ Ä‘áº·t chá»— thÃ nh cÃ´ng táº¡i ${st.name}! Thanh toÃ¡n báº±ng ${method}.`,
  confirmButtonText: 'OK',
  confirmButtonColor: '#3085d6'
});

});

// ===== Há»§y Ä‘áº·t chá»— =====
function cancelBooking(id){
  const idx=bookings.findIndex(b=>b.id===id);
  if(idx!==-1){
    const st=stations.find(s=>s.name===bookings[idx].station);
    if(st) st.slots++;
    bookings.splice(idx,1);

// Trá»« Ä‘iá»ƒm khi há»§y
    points = Math.max(0, points - 5);
    localStorage.setItem('ez_points', points);

    localStorage.setItem('ez_bookings',JSON.stringify(bookings));
    updateUI(); renderBookings(); renderStations();

    // >>> XÃ“A ROUTE (CHá»ˆ DáºªN) <<<
    if (window.currentRoute) {
      try { map.removeControl(window.currentRoute); } catch(e) {}
      window.currentRoute = null;
    }

    // >>> HIá»†N POPUP SWEETALERT2 <<<
    Swal.fire({
      icon: 'error',
      title: 'ÄÃƒ Há»¦Y Äáº¶T CHá»–',
      text: `Báº¡n Ä‘Ã£ há»§y Ä‘áº·t chá»— táº¡i ${st.name} vÃ  bá»‹ trá»« 5 Ä‘iá»ƒm.`,
      confirmButtonText: 'ÄÃ³ng',
      confirmButtonColor: '#d33'
    });
  }
}
// ===== XÃ³a cÃ¡c Ä‘áº·t chá»— háº¿t háº¡n =====
function cleanExpiredBookings(){
  const now=Date.now();
  let changed=false;
  bookings=bookings.filter(b=>{
    if(b.expire && now>b.expire){
      const st=stations.find(s=>s.name===b.station);
      if(st) st.slots++;
      changed=true;
      return false;
    }
    return true;
  });
  if(changed){
    localStorage.setItem('ez_bookings',JSON.stringify(bookings));
    renderBookings(); renderStations();
  }
}
setInterval(cleanExpiredBookings,60000);

// ===== Render Ä‘áº·t chá»— =====
function renderBookings(){
  const list=document.getElementById('bookings-list');
  list.innerHTML='';
  if(bookings.length===0){list.innerHTML='<div class="empty">ChÆ°a cÃ³ Ä‘áº·t chá»— nÃ o</div>'; return;}
  bookings.forEach(b=>{
    const remain = Math.max(0, Math.floor((b.expire-Date.now())/60000));
    const item=document.createElement('div');
    item.className='booking-item';
    item.innerHTML=`
      <div>
        <b>${b.station}</b><br>
        <span class="booking-meta">${b.date} â€” cÃ²n ${remain} phÃºt<br>
        GiÃ¡: ${b.price}k VND â€” ${b.status} (${b.method})</span>
      </div>
      <button class="btn ghost">Há»§y</button>
    `;
    item.querySelector('button').addEventListener('click',()=>cancelBooking(b.id));
    list.appendChild(item);
  });
}

// ===== Render tráº¡m sáº¡c =====
function renderStations(){
  document.getElementById('stations-list').innerHTML='';
  map.eachLayer(l=>{if(l instanceof L.Marker && !l._isTile) map.removeLayer(l);});
  let sortedStations=[...stations];
  if(userLocation){
    sortedStations.sort((a,b)=>distance(userLocation.lat,userLocation.lon,a.lat,a.lon)-
                              distance(userLocation.lat,userLocation.lon,b.lat,b.lon));
  }
  sortedStations.forEach(st=>{
    const item=document.createElement('div');
    let extra='';
    if(userLocation){
      extra = ` â€” ${distance(userLocation.lat,userLocation.lon,st.lat,st.lon).toFixed(1)} km`;
    }
    item.className='station-item';
    item.innerHTML=`<div><b>${st.name}</b><br><span class='station-meta'>${st.slots} chá»— trá»‘ng â€” ${st.price}k VND${extra}</span></div><button class='btn'>Äáº·t</button>`;
    item.querySelector('button').addEventListener('click',()=>bookFromMap(st.id));
    document.getElementById('stations-list').appendChild(item);
    const marker=L.marker([st.lat,st.lon]).addTo(map);
    marker.bindPopup(`<b>${st.name}</b><br>${st.slots} chá»— trá»‘ng â€” ${st.price}k VND<br><button class='btn' onclick='bookFromMap(${st.id})'>Äáº·t chá»—</button>`);
  });
}

// ===== Auto locate =====
function locateUser(auto=false){
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
      const {latitude,longitude}=pos.coords;
      userLocation={lat:latitude,lon:longitude};
      map.setView([latitude,longitude],15);
      L.circle([latitude,longitude],{radius:50,color:'blue'}).addTo(map).bindPopup('Báº¡n Ä‘ang á»Ÿ Ä‘Ã¢y').openPopup();
      renderStations();
    }, err=>{
      if(auto){ map.setView([10.8546,106.7840],13); renderStations(); }
      console.warn("KhÃ´ng láº¥y Ä‘Æ°á»£c GPS:",err.message);
    });
  }
}
document.getElementById('locate-btn').addEventListener('click',()=>locateUser(false));
document.getElementById('refresh-markers').addEventListener('click',renderStations);
locateUser(true);

// ===== Äiá»u hÆ°á»›ng =====
function showSection(sectionId){
  document.querySelectorAll('footer.nav button').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(sectionId).classList.add('active');
  document.querySelector(`footer.nav button[data-target="${sectionId}"]`)?.classList.add('active');
}
document.querySelectorAll('footer.nav button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    window.location.hash = btn.dataset.target;
    showSection(btn.dataset.target);
  });
});
window.addEventListener('load',()=>{
  const hash = window.location.hash.replace('#','');
  if(hash) showSection(hash);
  renderStations(); renderBookings();
});

// ===== Bá»™ chá»n kiá»ƒu báº£n Ä‘á»“ =====
const baseLayers = {
  street: L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: 'Â© OpenStreetMap' }),
  satellite: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: 'Tiles Â© Esri' }),
  terrain: L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', { attribution: 'Â© OpenTopoMap contributors' }),
};

// khá»Ÿi táº¡o máº·c Ä‘á»‹nh street
let currentLayer = baseLayers.street.addTo(map);

// hÃ m Ä‘á»•i lá»›p
function switchBase(layerName, btnId) {
  if (currentLayer) map.removeLayer(currentLayer);
  currentLayer = baseLayers[layerName].addTo(map);

  // active button
  document.querySelectorAll('#mapStyleSwitcher button').forEach(b => b.classList.remove('active'));
  document.getElementById(btnId).classList.add('active');
}

// gÃ¡n sá»± kiá»‡n cho nÃºt
document.getElementById('streetBtn').addEventListener('click', () => switchBase('street', 'streetBtn'));
document.getElementById('satelliteBtn').addEventListener('click', () => switchBase('satellite', 'satelliteBtn'));
document.getElementById('terrainBtn').addEventListener('click', () => switchBase('terrain', 'terrainBtn'));
</script>

